<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background: #0b0b0f;
            color: #fff;
        }

        header {
            padding: 20px;
            border-bottom: 1px solid #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            margin: 0;
            font-size: 20px;
            color: #e50914;
        }

        select {
            padding: 8px 10px;
            border-radius: 8px;
            background: #151521;
            color: #fff;
            border: 1px solid #333;
            cursor: pointer;
        }

        #movieList {
            padding: 10px 20px 40px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 30px;
        }

        @media (max-width:1100px) {
            #movieList {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width:900px) {
            #movieList {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width:700px) {
            #movieList {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width:520px) {
            #movieList {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        .card {
            background: #12121a;
            border: 1px solid #222;
            border-radius: 10px;
            overflow: hidden;
        }

        .card img {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            display: block;
            background: #0f0f15;
        }

        .card .title {
            padding: 12px 10px;
            font-size: 20px;
            font-weight: bold;
            min-height: 48px;

            text-align: center;

            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card .release-date {
            padding: 0 0 20px 0;
            font-size: 14px;
            color: #aaa;
            text-align: center;

            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page {
            text-align: center;
            padding-bottom: 40px;
        }

        .page button {
            padding: 10px 18px;
            border: 1px solid #333;
            border-radius: 10px;
            background: #151521;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
        }

        .page button:hover {
            background: #e50914;
            border-color: #e50914;
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.4);
        }

        .page button:active {
            transform: scale(0.96);
            box-shadow: none;
        }

        .page span {
            margin: 0 15px;
            font-size: 16px;
        }
    </style>

</head>

<body>

<header>
    <h1>영화 리스트</h1>
    <select id="category">
      <option value="popular">인기순</option>
      <option value="top_rated">별점순</option>
      <option value="now_playing">상영중</option>
      <option value="upcoming">상영예정</option>
    </select>
  </header>

  <div id="movieList"></div>


<script>

    // [실습 목표]
    //  - fetch or axios를 사용해서 TMDB 영화 데이터를 가져온다.
    //  - select에 따라 각기 다른 주소의 영화 데이터를 가져온다.
    //  - 최종적으로 가져온 영화 데이터를 반복문을 사용해서 innerHtml에 추가한다!

    let category = document.getElementById("category");
    let movieList = document.getElementById("movieList");

    // headers : 서버에 보내는 요청의 추가 정보
    // 요청의 성격을 함께 알려줄 때 사용

    // 1). Authoriztion
    //     : 인증 정보 전달
    //     : "Bearer {token}" 형식으로 사용

    // 2). Accept
    //     : 서버에서 받을 데이터 형식
    //     : application/json 이 기본값
    
    // 3). Content-Type
    //     : 서버로 보내는 데이터의 형식
    //     : application/json 등의 형식이 존재

    // 4). User-Agent
    //     : 요청을 보낸 클라이언트의 정보를 담고 있다.
    //     : 브라우저에 요청할 경우, 자동 생성




    const fetchMoviveData = async () => {
        const ACCESS_TOKEN = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJjODIwNzE1NWIwZTI2OWM4N2JiZGU4NGExNzZjYjRkMCIsIm5iZiI6MTcyNTMyMjUxNy4xMjcsInN1YiI6IjY2ZDY1NTE1OTc3ZmJlN2ZmN2E2ZTRlZSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ct6xhFwoqJrDgT8zIUe1xLFyIv9FfmBnW7J0L2G5re8";
        const API_BASE_URL = "https://api.themoviedb.org/3";
        const IMAGE_BASE_URL = "https://image.tmdb.org/t/p/original";

        const endpoints = [
            "/movie/popular",
            "/movie/top_rated",
            "/movie/now_playing",
            "/movie/upcoming"
        ];

        try {
            // 실습 : category 셀렉트의 선택된 option에 따라 endpoint 변수가 변경되도록 할 것
            let categoryStr = category.options[category.selectedIndex].value;
            console.log(categoryStr);
            
            // 선택한 Option의 값을 가져오기
            // 다른 풀이
            /* 
                const index = category.selectedIndex;
                const endpoint = endpoints[index];
            */

            const endpoint = `/movie/${categoryStr}`;
            const res = await fetch(`${API_BASE_URL}/movie/${categoryStr}?language=ko-KR&page=1`, {
                method : "GET",
                headers : {
                    Authorization : `Bearer ${ACCESS_TOKEN}`,
                }
            });
            const data = await res.json();
            console.log(data);

            // 실습 : 영화 목록을 for문을 사용해서 카드 생성
            /* 
                - 카드 구조

                <div class="card">
                    <img src={영화 포스터 주소}>
                    <div class="title">{영화 제목}</div>
                    <div class="release_date">개봉일 : {영화 개봉일}</div>
                </div>
            */
            movieList.innerHTML="";
            for (i = 0; i < data.results.length; i++) {
                movieList.innerHTML +=
                `<div class="card">
                    <img src=${IMAGE_BASE_URL + data.results[i].poster_path}>
                    <div class="title">${data.results[i].title}</div>
                    <div class="release-date">개봉일 : ${data.results[i].release_date}</div>
                </div>`
            }

        } catch (error) {
            console.log(error);
        }
    }
    fetchMoviveData();
    
    // 카테고리 셀렉트 변경 시 새로 영화 정보 받아오는 이벤트
    category.addEventListener("change", fetchMoviveData);
    

</script>

</body>

</html>